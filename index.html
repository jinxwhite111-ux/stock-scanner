<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Stock Scanner</title>
  <script src="https://unpkg.com/@ericblade/quagga2/dist/quagga.min.js"></script>
  <style>
    body { font-family: Arial; text-align: center; margin: 0; }
    #scanner { width: 100%; height: 60vh; }
    button { font-size: 18px; padding: 12px; margin: 6px; width: 45%; }
    input { font-size: 18px; padding: 8px; width: 80%; }
  </style>
</head>

<body>
  <h2>Stock Scan</h2>

  <div>
    <button onclick="setAction('IN')">SCAN IN</button>
    <button onclick="setAction('OUT')">SCAN OUT</button>
  </div>

  <p>Quantity</p>
  <input id="qty" type="number" min="1" value="1"/>

  <div id="scanner"></div>

  <p id="status"></p>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbybdGj77UWVJg-zT1kDbR1HKfAsO1JEvvmQevjkR6b9IMdhyDc2wrt51DUgA3Tjie8GJw/exec
";
let ACTION = 'IN';

function setAction(a) {
  ACTION = a;
  document.getElementById('status').innerText = 'Mode: ' + a;
}

Quagga.init({
  inputStream: {
    type: "LiveStream",
    target: document.querySelector('#scanner'),
    constraints: {
      facingMode: "environment"
    }
  },
  decoder: {
    readers: ["code_128_reader"]
  }
}, function(err) {
  if (err) { console.error(err); return; }
  Quagga.start();
});

Quagga.onDetected(function(result) {
  const sku = result.codeResult.code;
  Quagga.stop();
  sendScan(sku);
});

function sendScan(sku) {
  const qty = Number(document.getElementById('qty').value || 1);

  fetch(WEB_APP_URL, {
    method: "POST",
    body: JSON.stringify({
      sku: sku,
      action: ACTION,
      qty: qty
    })
  })
  .then(r => r.json())
  .then(res => {
    if (res.ok) {
      document.getElementById('status').innerText =
        `Recorded: ${ACTION} ${qty} Ã— ${sku}`;
    } else {
      document.getElementById('status').innerText =
        'Error: ' + res.error;
    }
    Quagga.start();
  });
}
</script>
</body>
</html>

